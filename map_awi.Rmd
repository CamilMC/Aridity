---
title: "Maps AWI"
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    code_folding: hide
date: "2023-12-13"
bibliography: AI.bib

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F, error = F, fig.align = "center", collapse = T)
```

```{r libraries}
library(raster)
library(dplyr)
library(ggplot2)
library(plyr)
library(viridisLite)
library(sf)
library(stringr)
```

```{r masks}
ex_raster <- raster("/bettik/crapartc/CMIP6/ts/ts_Amon_CMCC-CM2-SR5_historical_r1i1p1f1_gn_185001-201412.nc")
ex_raster.df <- as.data.frame(ex_raster, xy = T)

land_mask <- raster("Aridity/Masks/land_sea_mask_1degree.nc4") %>% projectRaster(ex_raster)
land_mask.df <- as.data.frame(land_mask, xy = T) %>% setNames(c("lon","lat","lm")) # 0 if ocean, 1 if land

ipcc_regions <- shapefile("Aridity/Masks/IPCC-WGI-reference-regions-v4.shp") %>% spTransform(crs("EPSG:4326")) 
ipcc_regions.raster <- ipcc_regions %>% rasterize(ex_raster)
ipcc_regions.df <- as.data.frame(ipcc_regions.raster, xy = T) %>% setNames(c("lon","lat","Continent","Type","Name","Acronym"))

```

```{r import-dfs}
awi_annual <- merge(read.table("/bettik/crapartc/Averages/ts/awi.hist.1850-1880.ts.txt"), read.table("/bettik/crapartc/Averages/ts/awi.hist.1985-2015.ts.txt"), by = c("lon", "lat")) %>%
merge(read.table("/bettik/crapartc/Averages/ts/awi.ssp245.2030-2060.ts.txt"), by = c("lon", "lat")) %>%
merge(read.table("/bettik/crapartc/Averages/ts/awi.ssp245.2070-2100.ts.txt"), by = c("lon", "lat")) %>%
merge(read.table("/bettik/crapartc/Averages/ts/awi.ssp370.2030-2060.ts.txt"), by = c("lon", "lat")) %>%
merge(read.table("/bettik/crapartc/Averages/ts/awi.ssp370.2070-2100.ts.txt"), by = c("lon", "lat")) %>%
merge(read.table("/bettik/crapartc/Averages/ts/awi.ssp585.2030-2060.ts.txt"), by = c("lon", "lat")) %>%
merge(read.table("/bettik/crapartc/Averages/ts/awi.ssp585.2070-2100.ts.txt"), by = c("lon", "lat")) %>%
setNames(c("lon", "lat", "hist_1850_1880", "hist_1985_2015","ssp245_2030_2060","ssp245_2070_2100","ssp370_2030_2060","ssp370_2070_2100","ssp585_2030_2060","ssp585_2070_2100"))


ggplot(awi_annual, aes(x = hist_1850_1880))+geom_point(aes(y = hist_1985_2015, col = "now"), size = 0.5, alpha = 0.5) + 
    geom_point(aes(y = ssp245_2070_2100, col = "ssp245"), size = 0.5, alpha = 0.5) + 
    geom_point(aes(y = ssp370_2070_2100, col = "ssp370"), size = 0.5, alpha = 0.5) + 
    geom_point(aes(y = ssp585_2070_2100, col = "ssp245"), size = 0.5, alpha = 0.5) + 
    scale_color_viridis_d()

awi_land <- merge(awi_annual, land_mask, )

```
