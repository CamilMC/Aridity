---
title: "Maps AWI"
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    code_folding: hide
date: "2023-12-13"
bibliography: AI.bib

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, error = FALSE, fig.align = "center", collapse = T)
```

```{r libraries}
library(raster)
library(dplyr)
library(ggplot2)
library(viridisLite)
library(sf)
library(stringr)
```

```{r masks}
cmcc <- raster("/bettik/crapartc/CMIP6/ts/ts_Amon_CMCC-CM2-SR5_historical_r1i1p1f1_gn_185001-201412.nc")
crs(cmcc) <- "EPSG:4326"
cmcc.df <- as.data.frame(ex_raster, xy = T)

land_mask <- raster("Aridity/Masks/land_sea_mask_1degree.nc4") 
extent(land_mask) <- extent(cmcc)
land_mask <-  projectRaster(from = land_mask, to = cmcc)
land_mask.df <- as.data.frame(land_mask, xy = T) %>% setNames(c("lon","lat","lm")) # 0 if ocean, 1 if land

ipcc_regions <- shapefile("Aridity/Masks/IPCC-WGI-reference-regions-v4.shp") %>% spTransform(crs("EPSG:4326")) 
ipcc_regions.raster <- ipcc_regions %>% rasterize(cmcc)
ipcc_regions.df <- as.data.frame(ipcc_regions.raster, xy = T) %>% setNames(c("lon","lat","Continent","Type","Name","Acronym"))
#ipcc_regions.sf <- st_as_sf(ipcc_regions.raster)
```

```{r awi-annual-long}
awi_annual <- rbind(mutate(read.table("/bettik/crapartc/Averages/ts/awi.hist.1850-1880.ts.txt"), model = "historical", period = "1850_1880"),mutate(read.table("/bettik/crapartc/Averages/ts/awi.hist.1985-2015.ts.txt"), model = "historical", period = "1985_2015")) %>%
rbind(mutate(read.table("/bettik/crapartc/Averages/ts/awi.ssp245.2030-2060.ts.txt"), model = "SSP245", period = "2030_2060")) %>%
rbind(mutate(read.table("/bettik/crapartc/Averages/ts/awi.ssp245.2070-2100.ts.txt"), model = "SSP245", period = "2070_2100")) %>%
rbind(mutate(read.table("/bettik/crapartc/Averages/ts/awi.ssp370.2030-2060.ts.txt"), model = "SSP370", period = "2030_2060")) %>%
rbind(mutate(read.table("/bettik/crapartc/Averages/ts/awi.ssp370.2070-2100.ts.txt"), model = "SSP370", period = "2070_2100")) %>%
rbind(mutate(read.table("/bettik/crapartc/Averages/ts/awi.ssp585.2030-2060.ts.txt"), model = "SSP585", period = "2030_2060")) %>%
rbind(mutate(read.table("/bettik/crapartc/Averages/ts/awi.ssp585.2070-2100.ts.txt"), model = "SSP585", period = "2070_2100"))

awi_land <- merge(awi_annual, land_mask.df, by = c("lon", "lat")) 
awi_ipcc <- merge(awi_land, ipcc_regions.df, by = c("lon", "lat"))

write.table(awi_ipcc, "Aridity/CMIP6/awi.ts_ipcc.txt")
```
